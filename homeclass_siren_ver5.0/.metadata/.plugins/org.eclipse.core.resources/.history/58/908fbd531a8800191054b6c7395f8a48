package dealim.cs.siren;


import java.util.List;

import javax.inject.Inject;

import org.json.simple.JSONObject;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import dealim.cs.siren.bean.TestBean;
import dealim.cs.siren.sevice.TestService;

@Controller
public class IdDuplicationController {
	
	private static final Logger logger = LoggerFactory.getLogger(IdDuplicationController.class);
	
	@Inject
	private TestService service;
	
	//사용할 service를 inject(삽입)
	@RequestMapping(value="/login",method = {RequestMethod.POST, RequestMethod.GET})//value는 사이트 주소 /login 입력시 이동
	public String test(TestBean test, Model model) throws Exception {
		//TestBean ob = new TestBean();
		
		logger.info("login");
		
		List<TestBean> list = service.user_login(test);
		
		System.out.println(list);
		//model.addAttribute("list",list);//쿼리문 실행후 TestBean 타입으로 저장된 데이터를 모델에 저장함 jsp에서 사용가능
		JSONObject json = new JSONObject();
		if(!list.isEmpty()) {
			//model.addAttribute("result",true);
			json.put("result", "o");
			for (TestBean testBean : list) {
				json.put("userid", testBean.email());
				json.put("user_password", testBean.getUser_password());
				System.out.println(testBean.email());
				System.out.println(testBean.getUser_password());
			}
		}
		else {
			json.put("result", "x");
			//model.addAttribute("result",false);
		}
		model.addAttribute("json",json);
		return "/login_succes";
		//DB에서 불러온 값은 Model에 담는다.
	}
}
