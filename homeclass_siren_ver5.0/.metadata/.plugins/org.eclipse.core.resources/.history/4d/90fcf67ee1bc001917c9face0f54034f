package dealim.cs.siren;

import java.util.List;

import javax.inject.Inject;

import org.json.simple.JSONObject;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import dealim.cs.siren.bean.Detail;
import dealim.cs.siren.sevice.TestService;

public class DetailInfo {
	@Inject
	TestService service;
	@RequestMapping(value="/detailInfo",method= {RequestMethod.GET,RequestMethod.POST})
    public @ResponseBody JSONObject tester(@RequestBody Detail test) throws Exception{ 
    	JSONObject json = new JSONObject();
    	System.out.println(test.getUserNum());
    	List<Detail> list;
    	int i=0; //디테일 리스트 수  
		try {
			list = service.detailInfo(test);
			System.out.println("디테일 리스트 불러오기 성공");
			
			if(!list.isEmpty()) {
				for (DiseaseConnect diseaseConnect : list) {
					i++;//리스트 수만큼 증가
					//병코드에 있는
					//약 리스트 받아오기
					list2 = service.userMedicine(diseaseConnect);
					System.out.println("약리스트 성공");
					json.put("medicine"+i,list2);
					//for (MedicineConnect testMedicine : list2) {
					//	System.out.println(testMedicine);
					//	json.put("userNum", testBean.getUserNum());
					//}
					
				}
				json.put("result","T");
				json.put("number",i);
				System.out.println("성공");
				System.out.println(json);
			}
			else {
				System.out.println("공백");
				json.put("result","null");
			}

		} catch (Exception e) {
			e.printStackTrace();
			System.out.println("실패");
			json.put("result","F");
			
		}
		
        return json;
    }
}
